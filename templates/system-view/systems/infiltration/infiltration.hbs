<div class="event-outer-container">
    <div class="flexrow">
        {{> "modules/pf2e-subsystems/templates/partials/navigate-back.hbs" label=(localize "PF2ESubsystems.Infiltration.NavigateBack") action="navigateToSystem" showTour=this.event clipboardFallback=this.clipboardFallback }}
        {{#if (or this.isGM this.event.preparations.usesPreparation)}}
            <nav class="tabs event-tabs secondary-container">
                {{#each this.infiltrationTabs as |tab|}}
                    <a 
                        class="{{tab.cssClass}} event-tab {{#if (and (eq tab.id "preparation") (not ../event.preparations.usesPreparation))}}unused{{/if}} tertiary-container" 
                        data-action="tab" 
                        data-group="{{tab.group}}" 
                        data-tab="{{tab.id}}"
                    >
                        <i class="{{tab.icon}}"></i>
                        <label>{{tab.label}}</label>
                    </a>
                {{/each}}
            </nav>
        {{/if}}
    </div>
    <div class="event-container">
        <div class="event-sidebar">
            <div class="infiltration-points-container event-section primary-container accent">
                <div class="event-section-title title-small-container primary-container">
                    {{localize "PF2ESubsystems.Infiltration.InfiltrationPoints"}}
                    {{this.event.totalInfiltrationPoints}}
                </div>
            </div>
            {{#if (or this.isGM (not this.settings.hideAwareness))}}
                <div class="awareness-points-container {{#if this.editMode}}edit-mode{{/if}} event-section primary-container accent">
                    <div class="awareness-points-inner-container event-section-title controls title-small-container primary-container">
                        {{localize "PF2ESubsystems.Infiltration.AwarenessPoints"}}&nbsp;
                        <div class="event-section-number-container diagonal-spaced">
                            {{#if (not this.editMode)}}
                                {{#if this.isGM}}<i class="fa-solid fa-caret-up clickable-icon event-section-number-upper" data-action="infiltrationUpdateAwarenessPoints" data-event="{{this.event.id}}" data-increase="true"></i>{{/if}}
                                {{#if this.isGM}}<i class="fa-solid fa-caret-up clickable-icon event-section-number-upper-diagonal" data-action="infiltrationUpdateHiddenAwarenessPoints" data-event="{{this.event.id}}" data-increase="true"></i>{{/if}}
                                {{#if this.isGM}}<div class="event-section-secondary-number" title="{{localize "PF2ESubsystems.Infiltration.HiddenAwarenessNumber"}}">{{this.event.awarenessPoints.hidden}}</div>{{/if}}
                                {{this.event.visibleAwareness}}
                                {{#if this.isGM}}<i class="fa-solid fa-caret-down clickable-icon {{#if (eq this.event.awarenessPoints.current 0)}}disabled{{/if}} event-section-number-lower" {{#if (gt this.event.awarenessPoints.current 0)}}data-action="infiltrationUpdateAwarenessPoints"{{/if}} data-event="{{this.event.id}}"></i>{{/if}}
                                {{#if this.isGM}}<i class="fa-solid fa-caret-down clickable-icon {{#if (eq this.event.awarenessPoints.hidden 0)}}disabled{{/if}} event-section-number-lower-diagonal" {{#if (gt this.event.awarenessPoints.hidden 0)}}data-action="infiltrationUpdateHiddenAwarenessPoints"{{/if}} data-event="{{this.event.id}}"></i>{{/if}}
                            {{else}}
                                <i class="fa-solid fa-plus" data-action="addInfiltrationAwarenessBreakpoint" data-event="{{this.event.id}}" title="{{localize "Add additional awareness breakpoint"}}"></i>
                            {{/if}}
                        </div>
                    </div>
                    <div class="awareness-point-breakpoints-container">
                        {{#each this.event.awarenessPoints.breakpoints}}
                            {{#if (or ../isGM (not this.playerHidden))}}
                                <div class="awareness-point-breakpoint-container {{#if this.open}}open{{/if}} secondary-container {{#if this.active}}accent{{/if}}">
                                    <div class="awareness-point-breakpoint-inner-container text-normal bold">
                                        {{this.breakpoint}}
                                        <div>{{localize "PF2ESubsystems.Basic.Points"}}</div>
                                        {{#if ../editMode}}
                                            <i class="fa-solid fa-trash clickable-icon awareness-point-breakpoint-delete" data-action="infiltrationRemoveAwarenessBreakpoint" data-event="{{../this.event.id}}" data-breakpoint="{{this.id}}"></i>
                                        {{else}}
                                            {{#if this.hideable}}<i class="fa-solid {{#if this.hidden}}fa-eye-slash{{else}}fa-eye{{/if}} clickable-icon awareness-point-breakpoint-hider" data-action="infiltrationToggleHideAwarenessBreakpoint" data-event="{{../this.event.id}}" data-breakpoint="{{this.id}}"></i>{{/if}}
                                            {{#if this.showActivate}}<i class="fa-solid fa-check clickable-icon awareness-point-breakpoint-enable {{#if this.inUse}}active{{/if}}" data-action="infiltrationToggleAwarenessBreakpointInUse" data-event="{{../this.event.id}}" data-breakpoint="{{this.id}}" title="{{localize "PF2ESubsystems.Infiltration.Awareness.ActivateAwarenessBreakpoint"}}"></i>{{/if}}
                                        {{/if}}
                                        
                                        <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon awareness-point-breakpoint-open" data-action="infiltrationToggleOpenAwarenessBreakpoint" data-breakpoint="{{this.id}}"></i> 
                                    </div>
                                    <div class="awareness-point-breakpoint-main-container {{#if this.open}}expanded{{/if}}">
                                        {{#if ../editMode}}
                                            <div class="event-field-group">
                                                <div class="event-field-form-col text-normal primary-text-container">
                                                    <div>{{localize "PF2ESubsystems.Basic.Breakpoint"}}</div>
                                                    <input type="text" data-dtype="Number" name="{{concat "events." ../event.id ".awarenessPoints.breakpoints." this.id ".breakpoint"}}" value="{{this.breakpoint}}" class="tertiary-container" />
                                                </div>
                                                <div class="event-field-form-col text-normal primary-text-container">
                                                    <div>{{localize "PF2ESubsystems.Basic.DCIncrease"}}</div>
                                                    <input type="text" data-dtype="Number" name="{{concat "events." ../event.id ".awarenessPoints.breakpoints." this.id ".dcIncrease"}}" value="{{this.dcIncrease}}" class="tertiary-container" />
                                                </div>
                                            </div>
                                            <fieldset class="dialog-editable-text-display tertiary-container">
                                                <legend>
                                                    <strong>{{localize "PF2ESubsystems.Basic.Description"}}</strong>
                                                    <i class="fa-solid fa-pen-to-square edit-icon clickable-icon" data-action="useEditTextDialog" data-path="{{concat "events." ../event.id ".awarenessPoints.breakpoints." this.id ".description" }}"></i>
                                                </legend>
                                                {{{this.enrichedDescription}}}
                                            </fieldset>
                                        {{else}}
                                            <div class="text-normal italic">{{{this.enrichedDescription}}}</div>
                                        {{/if}}
                                    </div>
                                </div>
                            {{/if}}
                        {{/each}}
                    </div>
                </div>
            {{/if}}
            <div class="edge-points-container event-section primary-container accent">
                <div class="event-section-title title-container primary-container">{{localize "PF2ESubsystems.Infiltration.EdgePoints"}}</div>
                <div class="infiltration-edges-container">
                    {{#each this.event.edgePoints}}
                        <div class="event-section-inner-container infiltration-edge-container secondary-container" data-edge="{{this.id}}">
                            {{#if ../editMode}}
                                <div class="event-section-header-container">
                                    <i class="fa-solid fa-trash event-section-delete-button" data-action="infiltrationEdgeRemove" data-event="{{../event.id}}" data-edge="{{this.id}}"></i>
                                    <div class="text-normal bold infiltration-edge-title {{#if this.used}}spent{{/if}}">{{this.name}}</div>
                                    <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationToggleOpenEdge" data-event="{{../event.id}}" data-edge="{{this.id}}"></i> 
                                </div>
                                <div class="event-section-body {{#if this.open}}expanded{{/if}}">
                                    <div class="event-field-group">
                                        <div class="event-field-form text-normal primary-text-container">
                                            <div>{{localize "PF2ESubsystems.Basic.Name"}}</div>
                                            <input type="text" name="{{concat "events." ../event.id ".edgePoints." this.id ".name"}}" value="{{this.name}}" class="tertiary-container" />
                                        </div>
                                    </div>
                                    <fieldset class="dialog-editable-text-display tertiary-container">
                                        <legend>
                                            <strong>{{localize "PF2ESubsystems.Basic.Description"}}</strong>
                                            <i class="fa-solid fa-pen-to-square edit-icon clickable-icon" data-action="useEditTextDialog" data-path="{{concat "events." ../event.id ".edgePoints." this.id ".description"}}"></i>
                                        </legend>
                                        {{{this.enrichedDescription}}}
                                    </fieldset>
                                </div>
                            {{else}}
                                <div class="event-section-header-container">
                                    {{#if (and ../isGM this.enrichedHiddenDescription)}}<i class="fa-solid {{#if this.faked}}fa-eye-slash{{else}}fa-eye{{/if}} clickable-icon event-section-hider" data-action="infiltrationToggleEdgeFaked" data-event="{{../event.id}}" data-edge="{{this.id}}"></i>{{/if}}
                                    {{#if ../isGM}}<i class="fa-solid fa-check clickable-icon edge-section-used {{#if this.used}}active{{/if}}" data-action="infiltrationToggleEdgeUsed" data-event="{{../event.id}}" data-edge="{{this.id}}"></i>{{/if}}
                                    <div class="text-normal bold infiltration-edge-title {{#if this.used}}spent{{/if}}">{{this.name}}</div>
                                    <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationToggleOpenEdge" data-event="{{../event.id}}" data-edge="{{this.id}}"></i> 
                                </div>

                                <div class="event-section-body {{#if this.open}}expanded{{/if}}">
                                    {{#if ../isGM}}
                                        {{#if (not this.enrichedHiddenDescription)}}
                                            <div class="text-helper-big">{{{this.enrichedDescription}}}</div>
                                        {{else}}
                                            {{#if (and this.faked this.enrichedHiddenDescription)}}
                                                <div class="text-helper-big">{{{this.enrichedDescription}}}</div>
                                                <div class="text-helper-big primary-text-container text-shadow-container" data-visibility="gm">{{{this.enrichedHiddenDescription}}}</div>
                                            {{else}}
                                                <div class="text-helper-big">{{{this.enrichedHiddenDescription}}}</div>
                                            {{/if}}
                                        {{/if}}
                                        
                                    {{else}}
                                        <div class="text-helper-big">{{{this.playerDescription}}}</div>
                                    {{/if}}
                                </div>
                            {{/if}}
                        </div>
                    {{/each}}
                </div>
            </div>
            {{#if this.isGM}}
                <nav class="tabs event-tabs sidebar-tabs secondary-container">
                    {{#each this.sidebarTabs as |tab|}}
                        <a 
                            class="{{tab.cssClass}} event-tab tertiary-container" 
                            data-action="tab" 
                            data-event="{{../event.id}}"
                            data-group="{{tab.group}}" 
                            data-tab="{{tab.id}}"
                        >
                            <label>{{tab.label}}</label>
                            <i class="event-tab-pin {{tab.icon}}"></i>
                        </a>
                    {{/each}}
                </nav>
            {{/if}}
            <div class="event-tab tab {{sidebarTabs.premise.cssClass}}" data-group="{{sidebarTabs.premise.group}}" data-tab="{{sidebarTabs.premise.id}}">
                <div class="sidebar-tab-container">
                    <div class="description-outer-container event-section primary-container accent">
                        <div class="event-section-title title-container primary-container">
                            <div class="event-section-inner-title">
                                {{localize "PF2ESubsystems.Basic.Premise"}}
                                {{#if this.editMode}}<i class="fa-solid fa-pen-to-square clickable-icon title-edit-icon" data-action="useEditTextDialog" data-path="{{concat "events." this.event.id ".premise"}}"></i>{{/if}}
                            </div>
                        </div>
                        <div class="description-container">
                            {{{this.event.enrichedPremise}}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="event-tab tab {{sidebarTabs.notes.cssClass}}" data-group="{{sidebarTabs.notes.group}}" data-tab="{{sidebarTabs.notes.id}}">
                <div class="sidebar-tab-container">
                    <div class="description-outer-container event-section primary-container accent">
                        <div class="event-section-title title-container primary-container">
                            <div class="event-section-inner-title">
                                {{localize "PF2ESubsystems.Basic.Notes"}}
                                {{#if this.editMode}}<i class="fa-solid fa-pen-to-square clickable-icon title-edit-icon" data-action="useEditTextDialog" data-path="{{concat "events." this.event.id ".gmNotes"}}"></i>{{/if}}
                            </div>
                        </div>
                        <div class="description-container"> 
                            {{{this.event.enrichedGMNotes}}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="event-main-container">
            <div class="event-header-container">
                <div class="event-header-title-container">
                    <div class="event-header-title title-container secondary-container">{{this.event.name}}</div>
                </div>
                {{> "modules/pf2e-subsystems/templates/partials/event-toolbar.hbs"}}
            </div>

            <div class="event-tab tab {{this.infiltrationTabs.infiltration.cssClass}}" data-group="{{this.infiltrationTabs.infiltration.group}}" data-tab="{{this.infiltrationTabs.infiltration.id}}">
                <div class="event-tab-container-major">
                    <fieldset class="event-radio-container infiltration-obstacle-container {{this.infiltrationObstacleStyle}} primary-container">
                        <legend class="event-radio-header">
                            {{#each this.event.objectives as |objective id|}}
                                {{#if (or (not objective.hidden) ../isGM)}}
                                    {{> "modules/pf2e-subsystems/templates/partials/radio-button.hbs" selected=(eq objective.position ../currentObjectiveNr) locked=this.hidden event=../event.id action="setCurrentInfiltrationObjective" obstacle=objective.position }}
                                {{/if}}
                            {{/each}}
                            {{#if this.editMode}}<i class="fa-solid fa-plus chase-event-display-add clickable-icon" data-action="addInfiltrationObjective" data-event="{{this.event.id}}" title="{{localize "PF2ESubsystems.Chase.AddObjective"}}"></i>{{/if}}
                        </legend>
                        <div class="title-container controls">
                            <div class="event-radio-title-outer">
                                <div class="event-radio-title primary-text-container">
                                    {{#if this.editMode}}
                                        <input type="text" class="tertiary-container" name="{{concat "events." this.event.id ".objectives." this.currentObjective.id ".name"}}" value="{{this.currentObjective.name}}" />
                                        <i class="fa-solid fa-trash event-radio-title-delete title-small-container clickable-icon {{#if (eq (PF2ESubSLength this.event.objectives) 1)}}disabled{{/if}}" {{#if (gt (PF2ESubSLength this.event.objectives) 1)}}data-action="removeInfiltrationObjective"{{/if}} data-event="{{this.event.id}}" data-objective="{{this.currentObjective.id}}"></i>
                                    {{else}}
                                        <div>
                                            <span>{{this.currentObjective.name}}</span>
                                        </div>
                                        {{#if (and (not this.settings.hideObstacleLockIcon) (and this.isGM (not (eq this.currentObjective.position 1))))}}
                                            <i class="fa-solid {{#if this.currentObjective.hidden}}fa-lock{{else}}fa-lock-open{{/if}} event-radio-lock clickable-icon" data-action="onToggleObstacleLock" data-event="{{this.event.id}}" data-position="{{this.currentObjective.position}}"></i>
                                        {{/if}}
                                    {{/if}}
                                </div>
                            </div>
                        </div>
                        <div class="event-main-view-container primary-container accent">
                            {{#if this.editMode}}<button class="tertiary-container objective-obstacle-add-button" data-action="addInfiltrationObstacle" data-event="{{this.event.id}}" data-objective="{{this.currentObjective.id}}"><i class="fa-solid fa-plus"></i>{{localize "PF2ESubsystems.Infiltration.AddNewObstacle"}}</button>{{/if}}                 
                            <div class="event-section-container">
                                {{#each this.currentObjective.obstacles}}
                                    {{#if (or ../isGM (not this.hidden))}}
                                        <div class="event-section-inner-container secondary-container">
                                            <div class="event-section-header-container">
                                                {{#if ../editMode}}
                                                    {{#if this.open}}
                                                        <nav class="tabs event-inner-tabs">
                                                            {{#each ../obstacleTabs as |tab|}}
                                                                <a 
                                                                    class="{{tab.cssClass}} tertiary-container" 
                                                                    data-action="tab" 
                                                                    data-group="{{tab.group}}" 
                                                                    data-tab="{{tab.id}}"
                                                                >
                                                                    <i class="{{tab.icon}}"></i>
                                                                    <label>{{tab.label}}</label>
                                                                </a>
                                                            {{/each}}
                                                        </nav>
                                                    {{else}}
                                                        <div class="title-small-container">
                                                            {{this.name}}
                                                        </div>
                                                    {{/if}}
                                                    <i class="fa-solid fa-trash clickable-icon event-section-delete-button" data-action="removeInfiltrationObstacle" data-event="{{../event.id}}" data-objective="{{../currentObjective.id}}" data-obstacle="{{this.id}}"></i>
                                                {{else}}
                                                    <div class="title-small-container">
                                                        {{this.name}}
                                                    </div>
                                                    {{#if ../isGM}}<i class="fa-solid {{#if this.hidden}}fa-eye-slash{{else}}fa-eye{{/if}} clickable-icon event-section-hider" data-action="infiltrationToggleObstacleHidden" data-event="{{../event.id}}" data-objective="{{../currentObjective.id}}" data-obstacle="{{this.id}}"></i>{{/if}}
                                                {{/if}}
                                                
                                                <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationToggleOpenObstacle" data-obstacle="{{this.id}}"></i> 
                                            </div>
                                            
                                            <div class="event-section-body {{#if this.open}}expanded{{/if}}">
                                                {{#if ../editMode}}
                                                    <div class="event-tab tab {{../obstacleTabs.description.cssClass}}" data-group="{{../obstacleTabs.description.group}}" data-tab="{{../obstacleTabs.description.id}}">
                                                        <div class="event-tab-container">
                                                            <div class="event-field-group">
                                                                <div class="event-field-form text-normal primary-text-container">
                                                                    <div>{{localize "PF2ESubsystems.Basic.Name"}}</div>
                                                                    <input type="text" name="{{concat "events." ../event.id ".objectives." ../currentObjective.id ".obstacles." this.id ".name" }}" value="{{this.name}}" class="tertiary-container" />
                                                                </div>
                                                                <div class="event-field-form small text-normal primary-text-container">
                                                                    <div>{{localize "PF2ESubsystems.Infiltration.InfiltrationPoints"}}</div>
                                                                    <input type="text" name="{{concat "events." ../event.id ".objectives." ../currentObjective.id ".obstacles." this.id ".infiltrationPoints.max" }}" value="{{this.infiltrationPoints.max}}" class="tertiary-container" />
                                                                </div>
                                                                <div class="event-field-form small text-normal primary-text-container">
                                                                    <div>{{localize "PF2ESubsystems.Infiltration.Individual"}}</div>
                                                                    <input type="checkbox" name="{{concat "events." ../event.id ".objectives." ../currentObjective.id ".obstacles." this.id ".individual" }}" {{checked this.individual}} />
                                                                </div>
                                                            </div>
                                                            <div class="infiltration-obstacle-image-container edit">
                                                                <div class="infiltration-obstacle-inner-container">
                                                                    <img class="clickable-icon infiltration-obstacle-image" src={{this.img}} data-action="editImage" data-path="{{concat "events." ../event.id ".objectives." ../currentObjective.id ".obstacles." this.id ".img" }}" />
                                                                </div>
                                                            </div>
                                                            <prose-mirror class="data-input tertiary-container" name="{{concat "events." ../event.id ".objectives." ../currentObjective.id ".obstacles." this.id ".description"}}" value="{{this.description}}">
                                                                {{{this.enrichedDescription}}}
                                                            </prose-mirror>
                                                        </div>
                                                    </div>

                                                    <div class="event-tab tab {{../obstacleTabs.skillChecks.cssClass}}" data-group="{{../obstacleTabs.skillChecks.group}}" data-tab="{{../obstacleTabs.skillChecks.id}}">
                                                        <div class="event-tab-container">
                                                            {{#with this}}
                                                                {{#each this.skillChecks}}
                                                                    <div class="event-field-group">
                                                                        <div class="event-field-form text-normal primary-text-container">
                                                                            <div>{{localize "PF2ESubsystems.Basic.DCAdjustments"}}</div>
                                                                            <input class="obstacle-dc-adjustment tertiary-container" value="{{this.dcAdjustments}}" data-event="{{../../event.id}}" data-objective="{{../../currentObjective.id}}" data-obstacle="{{../id}}" data-skill-check="{{this.id}}" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="event-skill-grid obstacle-skill-grid secondary-container">
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container first event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Lore"}}</div>
                                                                            {{#each this.columns.lore}}
                                                                                <div class="event-skill-grid-cell-container first">
                                                                                    <input type="checkbox" class="infiltration-obstacle-lore event-skill-grid-cell tertiary-checkbox" data-event="{{this.event}}" data-objective="{{this.objective}}" data-obstacle="{{this.obstacle}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" {{checked this.lore}} />
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Skill"}}</div>
                                                                            {{#each this.columns.skill}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    {{#if this.lore}}
                                                                                        <input type="text" value="{{this.skill}}" class="infiltration-obstacle-skill tertiary-container primary-text-container event-skill-grid-cell" data-event="{{this.event}}" data-objective="{{this.objective}}" data-obstacle="{{this.obstacle}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" />
                                                                                    {{else}}
                                                                                        <select name="{{concat "events." this.event ".objectives." this.objective ".obstacles." this.obstacle ".skillChecks." this.skillCheck ".skills." this.id ".skill" }}" class="tertiary-container primary-text-container event-skill-grid-cell">
                                                                                            {{selectOptions ../../../skillOptions selected=this.skill valueAttr="value" labelAttr="name" localize=true}}
                                                                                        </select>
                                                                                    {{/if}}
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Action"}}</div>
                                                                            {{#each this.columns.action}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    <select class="infiltration-obstacle-action-input tertiary-container primary-text-container event-skill-grid-cell" data-event="{{this.event}}" data-objective="{{this.objective}}" data-obstacle="{{this.obstacle}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}">
                                                                                        {{selectOptions ../../../actionOptions selected=this.action valueAttr="value" labelAttr="name" localize=true blank="" }}
                                                                                    </select>
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell-container event-skill-grid-cell informative header tertiary-container accent" title="{{localize "PF2ESubsystems.View.VariantExplanation"}}">{{localize "PF2ESubsystems.Basic.Variant"}}</div>
                                                                            {{#each this.columns.variant}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    <select name="{{concat "events." this.event ".objectives." this.objective ".obstacles." this.obstacle ".skillChecks." this.skillCheck ".skills." this.id ".variant" }}" class="tertiary-container primary-text-container event-skill-grid-cell" {{#if this.disabled}}disabled{{/if}}>
                                                                                        {{selectOptions this.variantOptions selected=this.variant valueAttr="value" labelAttr="name" localize=true blank="" }}
                                                                                    </select>
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell informative header tertiary-container accent" title="{{localize "PF2ESubsystems.Basic.LeveledDCExplanation"}}">{{localize "PF2ESubsystems.Basic.DC"}}*</div>
                                                                            {{#each this.columns.dc}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    <input type="text" data-dtype="Number" value="{{this.dc}}" name="{{concat "events." this.event ".objectives." this.objective ".obstacles." this.obstacle ".skillChecks." this.skillCheck ".skills." this.id ".difficulty.DC" }}" class="tertiary-container primary-text-container event-skill-grid-cell" {{#if this.leveledDC}}disabled{{/if}} />
                                                                                    <input type="checkbox" {{checked this.leveledDC}} class="infiltration-obstacle-leveled-dc tertiary-checkbox event-skill-grid-cell" data-event="{{this.event}}" data-objective="{{this.objective}}" data-obstacle="{{this.obstacle}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" />
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container last event-skill-grid-cell header tertiary-container accent">
                                                                                <i class="fa-solid fa-plus clickable-icon" data-action="infiltrationAddObstacleSkill" data-event="{{../../event.id}}" data-objective="{{../../currentObjective.id}}" data-obstacle="{{../id}}" data-skill-check="{{this.id}}"></i>
                                                                            </div>
                                                                            {{#each this.columns.action}}
                                                                                <div class="event-skill-grid-cell-container last">
                                                                                    <div class="event-skill-grid-cell spaced tools-column-cell">
                                                                                        <i class="fa-solid fa-tag clickable-icon label-tag {{#if this.label}}active{{/if}}" data-action="useSkillLabelMenu" data-path="{{concat "events." this.event ".objectives." this.objective ".obstacles." this.obstacle ".skillChecks." this.skillCheck ".skills." this.id }}" title="{{localize "PF2ESubsystems.Influence.EditInfluenceSkillLabel"}}"></i>
                                                                                        <i class="fa-solid fa-trash clickable-icon" data-action="infiltrationRemoveObstacleSkill" data-event="{{this.event}}" data-objective="{{this.objective}}" data-obstacle="{{this.obstacle}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}"></i>
                                                                                    </div>
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                    </div>
                                                                {{/each}}
                                                            {{/with}}
                                                        </div>
                                                    </div>
                                                {{else}}
                                                    <div class="infiltration-obstacle-image-container">
                                                        <div class="infiltration-obstacle-inner-container">
                                                            <img class="infiltration-obstacle-image" src="{{this.img}}" />
                                                        </div>
                                                        <div class="infiltration-obstacle-image-inner-container">
                                                            <div class="infiltration-obstacle-description">{{{this.enrichedDescription}}}</div>
                                                        </div>
                                                    </div>

                                                    {{#if this.individual}}
                                                        <div class="infiltration-points-individual-container">
                                                            {{#each this.individualInfiltrationPoints}}
                                                                <div class="infiltration-points-individual-inner-container title-small-container">
                                                                    <div>{{this.name}}</div>
                                                                    <div class="infiltration-points-container title-small-container">
                                                                        <div class="event-section-number-container">
                                                                            {{#if ../../isGM}}<i class="fa-solid fa-caret-up event-section-number-upper clickable-icon {{#if (eq this.value ../infiltrationPoints.max)}}disabled{{/if}}" {{#if (lt this.value ../infiltrationPoints.max)}}data-action="infiltrationObstacleIndividualPointsUpdate"{{/if}} data-event="{{../../event.id}}" data-objective="{{../../currentObjective.id}}" data-obstacle="{{../id}}" data-player="{{this.id}}" data-increase="true"></i>{{/if}}
                                                                            {{this.value}}
                                                                            {{#if ../../isGM}}<i class="fa-solid fa-caret-down clickable-icon {{#if (eq this.value 0)}}disabled{{/if}} event-section-number-lower" {{#if (gt this.value 0)}}data-action="infiltrationObstacleIndividualPointsUpdate"{{/if}} data-event="{{../../event.id}}" data-objective="{{../../currentObjective.id}}" data-obstacle="{{../id}}" data-player="{{this.id}}"></i>{{/if}}
                                                                        </div>
                                                                        /
                                                                        <div>{{../infiltrationPoints.max}}</div>
                                                                    </div>
                                                                </div>
                                                            {{/each}}
                                                        </div>
                                                    {{else}}
                                                        <div class="infiltration-points-container title-small-container">
                                                            <div>{{localize "PF2ESubsystems.Infiltration.InfiltrationPoints"}}</div>
                                                            <div class="event-section-number-container">
                                                                {{#if ../isGM}}<i class="fa-solid fa-caret-up event-section-number-upper clickable-icon {{#if (eq this.infiltrationPoints.current this.infiltrationPoints.max)}}disabled{{/if}}" {{#if (lt this.infiltrationPoints.current this.infiltrationPoints.max)}}data-action="infiltrationObstaclePointsUpdate"{{/if}} data-event="{{../event.id}}" data-objective="{{../currentObjective.id}}" data-obstacle="{{this.id}}" data-increase="true"></i>{{/if}}
                                                                {{this.infiltrationPoints.current}}
                                                                {{#if ../isGM}}<i class="fa-solid fa-caret-down clickable-icon {{#if (eq this.infiltrationPoints.current 0)}}disabled{{/if}} event-section-number-lower" {{#if (gt this.infiltrationPoints.current 0)}}data-action="infiltrationObstaclePointsUpdate"{{/if}} data-event="{{../event.id}}" data-objective="{{../currentObjective.id}}" data-obstacle="{{this.id}}"></i>{{/if}}
                                                            </div>
                                                            /
                                                            <div>{{this.infiltrationPoints.max}}</div>
                                                        </div>
                                                    {{/if}}

                                                    {{#each this.skillChecks}}
                                                        <div class="infiltration-complication-skill-container">
                                                            <div class="title-small-container">{{localize "PF2ESubsystems.Basic.Overcome"}}</div>
                                                            <div class="infiltration-complication-skill-buttons">
                                                                {{#each this.dcAdjustmentValues}}
                                                                    <div 
                                                                        class="infiltration-complication-skill-adjustment primary-text-container tertiary-container clickable-icon {{#if (not (eq this.value ../selectedAdjustment))}}inactive{{/if}}" 
                                                                        data-action="infiltrationObstacleToggleAdjustment" data-event="{{../../../event.id}}" data-objective="{{../../../currentObjective.id}}" data-obstacle="{{../../id}}" data-skill-check="{{../id}}" data-adjustment="{{this.value}}"
                                                                    >
                                                                        {{this.name}}
                                                                    </div>
                                                                {{/each}}
                                                            </div>
                                                            <div class="infiltration-complication-skill-buttons">
                                                                {{#each this.skills}}
                                                                    <div class="flexrow">
                                                                        {{{this.element}}}
                                                                        {{#if this.label}}<div class="text-normal italic {{#if (not ../selectedAdjustment)}}disabled{{/if}}">({{this.label}})</div>{{/if}}
                                                                    </div>
                                                                {{/each}}
                                                            </div>
                                                        </div>
                                                    {{/each}}
                                                {{/if}}
                                            </div>
                                        </div>
                                    {{/if}}
                                {{/each}}
                            </div>
                        </div>
                    </fieldset>

                    {{#if (or this.editMode (gt (PF2ESubSLength this.event.opportunities) 0))}}
                        <div class="infiltration-opportunity-container {{this.infiltrationOpportunityStyle}} event-section split primary-container accent">
                            <div class="event-section-title title-container primary-container">
                                <div class="title-container-inner">
                                    {{localize "PF2ESubsystems.Infiltration.Opportunities"}}
                                    {{#if this.editMode}}<i class="fa-solid fa-plus clickable-icon" data-action="addInfiltrationOpportunity" data-event="{{this.event.id}}"></i>{{/if}}
                                </div>
                            </div>
                            <div class="event-section-container infiltration-opportunities-container">
                                {{#each this.event.opportunities}}
                                    {{#if (or ../isGM (not this.hidden))}}
                                        <div class="event-section-inner-container secondary-container">
                                            {{#if ../editMode}}
                                                <div class="event-section-header-container">
                                                    <div class="title-small-container">
                                                        {{this.name}}
                                                    </div>
                                                    <i class="fa-solid fa-trash clickable-icon event-section-delete-button" data-action="removeInfiltrationOpportunity" data-event="{{../event.id}}" data-opportunity={{this.id}}></i>
                                                    <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationToggleOpenOpportunity" data-opportunity="{{this.id}}"></i> 
                                                </div>

                                                <div class="event-section-body {{#if this.open}}expanded{{/if}}">
                                                    <div class="event-field-group">
                                                        <div class="event-field-form text-normal primary-text-container">
                                                            <div>{{localize "PF2ESubsystems.Basic.Name"}}</div>
                                                            <input type="text" name="{{concat "events." ../event.id ".opportunities." this.id ".name"}}" value="{{this.name}}" class="tertiary-container" />
                                                        </div>
                                                    </div>
                                                    <div class="event-field-group">
                                                        <div class="event-field-form text-normal primary-text-container">
                                                            <div>{{localize "PF2ESubsystems.Infiltration.Requirements"}}</div>
                                                            <input type="text" name="{{concat "events." ../event.id ".opportunities." this.id ".requirements"}}" value="{{this.requirements}}" class="tertiary-container" />
                                                        </div>
                                                    </div>
                                                    <prose-mirror class="data-input tertiary-container" name="{{concat "events." ../event.id ".opportunities." this.id ".description"}}" value="{{this.description}}" placeholder="{{localize "PF2ESubsystems.Infiltration.OpportunityDescription"}}">
                                                        {{{this.enrichedDescription}}}
                                                    </prose-mirror>
                                                </div>
                                            {{else}}
                                                <div class="event-section-header-container">
                                                    <div class="title-small-container">
                                                        {{this.name}}
                                                    </div>
                                                    {{#if ../isGM}}<i class="fa-solid {{#if this.hidden}}fa-eye-slash{{else}}fa-eye{{/if}} clickable-icon event-section-hider" data-action="infiltrationToggleOpportunityHidden" data-event="{{../event.id}}" data-opportunity="{{this.id}}"></i>{{/if}}
                                                    <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationToggleOpenOpportunity" data-opportunity="{{this.id}}"></i> 

                                                    <div class="subtext col text-helper-big">
                                                        <div class="subtext-title">{{localize "PF2ESubsystems.Infiltration.Requirements"}}:</div>
                                                        {{{this.requirements}}}
                                                    </div>
                                                </div>
                                                <div class="event-section-body {{#if this.open}}expanded{{/if}}">
                                                    <div class="text-normal italic">{{{this.enrichedDescription}}}</div>
                                                </div>
                                            {{/if}}
                                        </div>
                                    {{/if}}
                                {{/each}}
                            </div>
                        </div>
                    {{/if}}

                    {{#if (or this.editMode (gt (PF2ESubSLength this.event.complications) 0))}}
                        <div class="infiltration-complication-container {{this.infiltrationComplicationStyle}} event-section split primary-container accent">
                            <div class="event-section-title title-container primary-container">
                                <div class="title-container-inner">
                                    {{localize "PF2ESubsystems.Infiltration.Complications"}}
                                    {{#if this.editMode}}<i class="fa-solid fa-plus clickable-icon" data-action="addInfiltrationComplication" data-event="{{this.event.id}}"></i>{{/if}}
                                </div>
                            </div>
                            <div class="infiltration-complications-container event-section-container">
                                <div class="event-section-item-container">
                                    {{#each this.event.extendedComplications}}
                                        {{#if (or ../isGM (not this.hidden))}}
                                            <div class="event-section-inner-container secondary-container">
                                                {{#if ../editMode}}
                                                    <div class="event-section-header-container">
                                                        {{#if this.open}}
                                                            <nav class="tabs event-inner-tabs">
                                                                {{#each ../complicationTabs as |tab|}}
                                                                    <a 
                                                                        class="{{tab.cssClass}} tertiary-container" 
                                                                        data-action="tab" 
                                                                        data-group="{{tab.group}}" 
                                                                        data-tab="{{tab.id}}"
                                                                    >
                                                                        <i class="{{tab.icon}}"></i>
                                                                        <label>{{tab.label}}</label>
                                                                    </a>
                                                                {{/each}}
                                                            </nav>
                                                        {{else}}
                                                            <div class="title-small-container">
                                                                {{this.name}}
                                                            </div>
                                                        {{/if}}
                                                        
                                                        <i class="fa-solid fa-trash clickable-icon event-section-delete-button" data-action="removeInfiltrationComplication" data-event="{{../event.id}}" data-complication={{this.id}}></i>
                                                        <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationToggleOpenComplication" data-complication="{{this.id}}"></i> 
                                                    </div>
                                                    <div class="event-section-body {{#if this.open}}expanded{{/if}}">
                                                        <div class="event-tab tab {{../complicationTabs.description.cssClass}}" data-group="{{../complicationTabs.description.group}}" data-tab="{{../complicationTabs.description.id}}">
                                                            <div class="event-tab-container">
                                                                <div class="event-field-group">
                                                                    <div class="event-field-form text-normal primary-text-container">
                                                                        <div>{{localize "PF2ESubsystems.Basic.Name"}}</div>
                                                                        <input type="text" name="{{concat "events." ../event.id ".complications." this.id ".name"}}" value="{{this.name}}" class="tertiary-container" />
                                                                    </div>
                                                                    <div class="event-field-form small text-normal primary-text-container">
                                                                        <div>{{localize "PF2ESubsystems.Infiltration.MaxInfiltrationPoints"}}</div>
                                                                        <input type="text" value="{{this.infiltrationPoints.max}}" data-event="{{../event.id}}" data-complication="{{this.id}}" class="complication-max-infiltration-pointers tertiary-container" />
                                                                    </div>
                                                                </div>
                                                                <div class="event-field-group">
                                                                    <div class="event-field-form text-normal primary-text-container">
                                                                        <div>{{localize "PF2ESubsystems.Infiltration.Trigger"}}</div>
                                                                        <input type="text" name="{{concat "events." ../event.id ".complications." this.id ".trigger"}}" value="{{this.trigger}}" class="tertiary-container" />
                                                                    </div>
                                                                </div>
                                                                <prose-mirror class="data-input tertiary-container" name="{{concat "events." ../event.id ".complications." this.id ".description"}}" value="{{this.description}}" placeholder="{{localize "PF2ESubsystems.Infiltration.ComplicationsDescription"}}">
                                                                    {{{this.enrichedDescription}}}
                                                                </prose-mirror>
                                                            </div>
                                                        </div>
                                                        <div class="event-tab tab {{../complicationTabs.skillChecks.cssClass}}" data-group="{{../complicationTabs.skillChecks.group}}" data-tab="{{../complicationTabs.skillChecks.id}}">
                                                            <div class="event-tab-container">
                                                                {{#each this.skillChecks}}
                                                                    <div class="event-field-group">
                                                                        <div class="event-field-form text-normal primary-text-container">
                                                                            <div>{{localize "PF2ESubsystems.Basic.DCAdjustments"}}</div>
                                                                            <input class="complication-dc-adjustment tertiary-container" value="{{this.dcAdjustments}}" data-event="{{../../event.id}}" data-complication="{{../id}}" data-skill-check="{{this.id}}" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="event-field-group">
                                                                        <div class="event-field-form small text-normal primary-text-container">
                                                                            <div>{{localize "PF2ESubsystems.Basic.UseLeveledDC"}}</div>
                                                                            <input type="checkbox" class="infiltration-complication-leveled-DC tertiary-checkbox" data-event="{{../../event.id}}" data-complication="{{../id}}" data-skill-check="{{this.id}}" {{checked this.difficulty.leveledDC}} />
                                                                        </div>
                                                                        <div class="event-field-form text-normal primary-text-container">
                                                                            <div>{{localize "PF2ESubsystems.Basic.DC"}}</div>
                                                                            <input type="text" name="{{concat "events." ../../event.id ".complications." ../id ".skillChecks." this.id ".difficulty.DC"}}" value="{{this.difficulty.DC}}" class="tertiary-container" {{#if this.difficulty.leveledDC}}disabled placeholder="{{localize "PF2ESubsystems.Basic.LeveledDCIsUsed"}}"{{/if}} />
                                                                        </div>
                                                                    </div>
                                                                    <div class="event-skill-grid complication-skill-grid secondary-container">
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container first event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Lore"}}</div>
                                                                            {{#each this.columns.lore}}
                                                                                <div class="event-skill-grid-cell-container first">
                                                                                    <input type="checkbox" class="infiltration-complication-lore event-skill-grid-cell tertiary-checkbox" data-event="{{this.event}}" data-complication="{{this.complication}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" {{checked this.lore}} />
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Skill"}}</div>
                                                                            {{#each this.columns.skill}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    {{#if this.lore}}
                                                                                        <input type="text" value="{{this.skill}}" class="infiltration-complication-skill tertiary-container primary-text-container event-skill-grid-cell" data-event="{{this.event}}" data-complication="{{this.complication}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" />
                                                                                    {{else}}
                                                                                        <select name="{{concat "events." this.event ".complications." this.complication ".skillChecks." this.skillCheck ".skills." this.id ".skill" }}" class="tertiary-container primary-text-container event-skill-grid-cell">
                                                                                            {{selectOptions ../../../skillOptions selected=this.skill valueAttr="value" labelAttr="name" localize=true}}
                                                                                        </select>
                                                                                    {{/if}}
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Action"}}</div>
                                                                            {{#each this.columns.action}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    <select class="infiltration-complication-action-input tertiary-container primary-text-container event-skill-grid-cell" data-event="{{this.event}}" data-complication="{{this.complication}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}">
                                                                                        {{selectOptions ../../../actionOptions selected=this.action valueAttr="value" labelAttr="name" localize=true blank="" }}
                                                                                    </select>
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell informative header tertiary-container accent" title="{{localize "PF2ESubsystems.View.VariantExplanation"}}">{{localize "PF2ESubsystems.Basic.Variant"}}</div>
                                                                            {{#each this.columns.variant}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    <select name="{{concat "events." this.event ".complications." this.complication ".skillChecks." this.skillCheck ".skills." this.id ".variant" }}" class="tertiary-container primary-text-container event-skill-grid-cell" {{#if this.disabled}}disabled{{/if}}>
                                                                                        {{selectOptions this.variantOptions selected=this.variant valueAttr="value" labelAttr="name" localize=true blank="" }}
                                                                                    </select>
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container event-skill-grid-cell informative header tertiary-container accent" title="{{localize "PF2ESubsystems.Basic.LeveledDCExplanation"}}">{{localize "PF2ESubsystems.Basic.DC"}}*</div>
                                                                            {{#each this.columns.dc}}
                                                                                <div class="event-skill-grid-cell-container">
                                                                                    <input type="text" data-dtype="Number" value="{{this.dc}}" name="{{concat "events." this.event ".complications." this.complication ".skillChecks." this.skillCheck ".skills." this.id ".difficulty.DC" }}" class="tertiary-container primary-text-container event-skill-grid-cell" {{#if this.leveledDC}}disabled{{/if}} />
                                                                                    <input type="checkbox" {{checked this.leveledDC}} class="infiltration-complication-leveled-dc tertiary-checkbox event-skill-grid-cell" data-event="{{this.event}}" data-complication="{{this.complication}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" />
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                        <div class="event-skill-grid-col">
                                                                            <div class="event-skill-grid-cell-container last event-skill-grid-cell header tertiary-container accent">
                                                                                <i class="fa-solid fa-plus clickable-icon" data-action="infiltrationAddComplicationSkill" data-event="{{../../event.id}}" data-complication="{{../id}}" data-skill-check="{{this.id}}"></i>
                                                                            </div>
                                                                            {{#each this.columns.action}}
                                                                                <div class="event-skill-grid-cell-container last">
                                                                                    <div class="event-skill-grid-cell spaced tools-column-cell">
                                                                                        <i class="fa-solid fa-tag clickable-icon label-tag {{#if this.label}}active{{/if}}" data-action="useSkillLabelMenu" data-path="{{concat "events." this.event ".complications." this.complication ".skillChecks." this.skillCheck ".skills." this.id }}" title="{{localize "PF2ESubsystems.Influence.EditInfluenceSkillLabel"}}"></i>
                                                                                        <i class="fa-solid fa-trash clickable-icon" data-action="infiltrationRemoveComplicationSkill" data-event="{{this.event}}" data-complication="{{this.complication}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}"></i>
                                                                                    </div>
                                                                                </div>
                                                                            {{/each}}
                                                                        </div>
                                                                    </div>
                                                                {{/each}}
                                                            </div>
                                                        </div>
                                                        <div class="event-tab tab {{../complicationTabs.results.cssClass}}" data-group="{{../complicationTabs.results.group}}" data-tab="{{../complicationTabs.results.id}}">
                                                            <div class="event-tab-container">
                                                                <div class="infiltration-result-buttons">
                                                                    {{#each this.results}}
                                                                        <button 
                                                                            class="tertiary-container {{#if this.selected}}accent{{/if}} infiltration-result-button {{#if this.inUse}}active{{/if}}" 
                                                                            data-action="infiltrationComplicationResultSelect" data-event="{{../../event.id}}" data-complication="{{../id}}" data-result="{{this.degreeOfSuccess}}"
                                                                        >
                                                                            {{this.name}}
                                                                            <i class="fa-solid fa-check clickable-icon" data-action="infiltrationComplicationResultToggle" data-event="{{../../event.id}}" data-complication="{{../id}}" data-result="{{this.degreeOfSuccess}}"></i>
                                                                        </button>
                                                                    {{/each}}
                                                                </div>
                                                                {{#if this.selectedResult}}
                                                                    <prose-mirror class="data-input tertiary-container" name="{{concat "events." ../event.id ".complications." this.id ".results." this.selectedResult.degreeOfSuccess ".description"}}" value="{{this.selectedResult.description}}" placeholder="{{localize "PF2ESubsystems.Infiltration.ComplicationResultDescription"}}">
                                                                        {{{this.selectedResult.enrichedDescription}}}
                                                                    </prose-mirror>
                                                                {{/if}}
                                                            </div>
                                                        </div>
                                                    </div>
                                                {{else}}
                                                    <div class="event-section-header-container">
                                                        <div class="title-small-container">
                                                            {{this.name}}
                                                        </div>
                                                        {{#if ../isGM}}<i class="fa-solid {{#if this.hidden}}fa-eye-slash{{else}}fa-eye{{/if}} clickable-icon event-section-hider" data-action="infiltrationToggleComplicationHidden" data-event="{{../event.id}}" data-complication="{{this.id}}"></i>{{/if}}
                                                        <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationToggleOpenComplication" data-complication="{{this.id}}"></i> 

                                                        <div class="subtext text-helper-big">
                                                            <div class="subtext-title">{{localize "PF2ESubsystems.Basic.Trigger"}}:</div>
                                                            &nbsp;
                                                            <div>{{this.trigger}}</div>
                                                        </div> 
                                                    </div>
                                                    <div class="event-section-body {{#if this.open}}expanded{{/if}}">
                                                        {{{this.enrichedDescription}}}
                                                        {{#if (gt this.infiltrationPoints.max 0)}}
                                                            <div class="infiltration-points-container title-small-container">
                                                                <div>{{localize "PF2ESubsystems.Infiltration.InfiltrationPoints"}}</div>
                                                                <div class="event-section-number-container">
                                                                    {{#if ../isGM}}<i class="fa-solid fa-caret-up event-section-number-upper clickable-icon {{#if (eq this.infiltrationPoints.current this.infiltrationPoints.max)}}disabled{{/if}}" {{#if (lt this.infiltrationPoints.current this.infiltrationPoints.max)}}data-action="complicationInfiltrationPointsUpdate"{{/if}} data-event="{{../event.id}}" data-complication="{{this.id}}" data-increase="true"></i>{{/if}}
                                                                    {{this.infiltrationPoints.current}}
                                                                    {{#if ../isGM}}<i class="fa-solid fa-caret-down clickable-icon {{#if (eq this.infiltrationPoints.current 0)}}disabled{{/if}} event-section-number-lower" {{#if (gt this.infiltrationPoints.current 0)}}data-action="complicationInfiltrationPointsUpdate"{{/if}} data-event="{{../event.id}}" data-complication="{{this.id}}"></i>{{/if}}
                                                                </div>
                                                                /
                                                                <div>{{this.infiltrationPoints.max}}</div>
                                                            </div>
                                                        {{/if}}
                                                        {{#each this.skillChecks}}
                                                            <div class="infiltration-complication-skill-container">
                                                                <div class="title-small-container">{{localize "PF2ESubsystems.Basic.Overcome"}}</div>
                                                                <div class="infiltration-complication-skill-buttons">
                                                                    {{#each this.dcAdjustmentValues}}
                                                                        <div 
                                                                            class="infiltration-complication-skill-adjustment primary-text-container tertiary-container {{#if ../../../isGM}}clickable-icon{{/if}} {{#if (not (eq this.value ../selectedAdjustment))}}inactive{{/if}}" 
                                                                            {{#if ../../../isGM}}data-action="infiltrationComplicationToggleAdjustment"{{/if}} data-event="{{../../../event.id}}" data-complication="{{../../id}}" data-skill-check="{{../id}}" data-adjustment="{{this.value}}">{{this.name}}
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                                <div class="infiltration-complication-skill-buttons">
                                                                    {{#each this.skills}}
                                                                        <div class="flexrow">
                                                                            {{{this.element}}}
                                                                            {{#if this.label}}<div class="text-normal italic {{#if (not ../selectedAdjustment)}}disabled{{/if}}">({{this.label}})</div>{{/if}}
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                            </div>
                                                        {{/each}}
                                                        <div class="infiltration-results-container">
                                                            <div class="infiltration-results-container">
                                                                {{#each this.results}}
                                                                    {{#if this.inUse}}
                                                                        <div class="preparation-activity-results-description">{{{this.enrichedDescription}}}</div>
                                                                    {{/if}}
                                                                {{/each}}
                                                            </div>
                                                        </div>
                                                    </div>
                                                {{/if}}
                                            </div>
                                        {{/if}}
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                    {{/if}}
                </div>
            </div>
            <div class="event-tab tab {{this.infiltrationTabs.preparation.cssClass}}" data-group="{{this.infiltrationTabs.preparation.group}}" data-tab="{{this.infiltrationTabs.preparation.id}}">
                <div class="event-tab-container">
                    <div class="preparation-container">
                        {{#if this.isGM}}
                            <div class="preparation-toolbar secondary-container">
                                <button data-action="infiltrationPreparationsToggleIsUsed" data-event="{{this.event.id}}" class="tertiary-container">
                                    {{#if this.event.preparations.usesPreparation}}
                                        <i class="fa-solid fa-check"></i>
                                        <div>{{localize "PF2ESubsystems.Infiltration.Preparations.IsUsed"}}</div>
                                    {{else}}
                                        <i class="fa-solid fa-circle-xmark"></i>
                                        <div>{{localize "PF2ESubsystems.Infiltration.Preparations.NotUsed"}}</div>
                                    {{/if}}
                                </button>
                                <div class="preparation-toolbar-inner">
                                    <i class="fa-solid fa-plus clickable-icon" data-action="infiltrationPreparationsActivityAdd" data-event="{{this.event.id}}"></i>
                                    <i class="fa-solid fa-rotate-left clickable-icon" data-action="infiltrationPreparationsActivitiesReset" data-event="{{this.event.id}}" title="{{localize "PF2ESubsystems.Basic.RestoreToDefault"}}"></i>
                                </div>
                            </div>
                        {{/if}}
                        <div class="preparation-cards-container">
                            {{#each this.event.extendedPreparations.activities}}
                                {{#if (or ../isGM (not this.hidden))}}
                                    <div class="event-section-inner-container preparation-card primary-container" data-activity="{{this.id}}">
                                        <div class="event-section-header-container preparation-activity-header">
                                            {{#if ../editMode}}
                                                {{#if this.open}}
                                                    <nav class="tabs event-inner-tabs">
                                                        {{#each ../activityTabs as |tab|}}
                                                            <a 
                                                                class="{{tab.cssClass}} secondary-container" 
                                                                data-action="tab" 
                                                                data-group="{{tab.group}}" 
                                                                data-tab="{{tab.id}}"
                                                            >
                                                                <i class="{{tab.icon}}"></i>
                                                                <label>{{tab.label}}</label>
                                                            </a>
                                                        {{/each}}
                                                    </nav>
                                                {{else}}
                                                    <div class="title-small-container">
                                                        {{this.name}}
                                                    </div>
                                                {{/if}}

                                                <i class="fa-solid fa-trash clickable-icon event-section-delete-button" data-action="infiltrationPreparationsActivityRemove" data-event="{{../event.id}}" data-activity="{{this.id}}"></i>
                                                <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationPreparationsToggleOpenActivity" data-activity="{{this.id}}"></i> 
                                            {{else}}
                                                <div class="preparation-card-tags">
                                                    {{#if ../isGM}}<i class="fa-solid {{#if this.hidden}}fa-eye-slash{{else}}fa-eye{{/if}} clickable-icon preparation-card-hider" data-action="infiltrationPreparationActivityToggleHidden" data-event="{{../this.event.id}}" data-activity="{{this.id}}"></i>{{/if}}
                                                    {{#each this.displayTags}}
                                                        <div class="preparation-card-tag secondary-container">{{this}}</div>
                                                    {{/each}}
                                                </div>
                                                <div class="title-small-container">
                                                    {{this.name}}
                                                </div>
                                                {{#if (gt this.maxAttempts 0)}}<div class="text-helper-big preparation-section-attempts-counter">{{localize "Max Attempts:"}}&nbsp;{{this.maxAttempts}}</div>{{/if}}
                                                <i class="fa-solid {{#if this.open}}fa-angle-down{{else}}fa-angle-up{{/if}} clickable-icon event-section-opener" data-action="infiltrationPreparationsToggleOpenActivity" data-activity="{{this.id}}"></i> 
                                            {{/if}}
                                        </div>
                                        <div class="event-section-body {{#if this.open}}expanded{{/if}} preparation-activity-body">
                                            {{#if ../editMode}}
                                                <div class="event-tab tab {{../activityTabs.description.cssClass}}" data-group="{{../activityTabs.description.group}}" data-tab="{{../activityTabs.description.id}}">
                                                    <div class="event-tab-container">
                                                            <input class="infiltration-preparations-activity-tags tertiary-container" value="{{this.tags}}" data-event="{{../event.id}}" data-activity="{{this.id}}" />
                                                        <div class="event-field-group">
                                                            <div class="event-field-form text-normal primary-text-container">
                                                                <div>{{localize "PF2ESubsystems.Basic.Name"}}</div>
                                                                <input type="text" name="{{concat "events." ../event.id ".preparations.activities." this.id ".name"}}" value="{{this.name}}" class="secondary-container" />
                                                            </div>
                                                        </div>
                                                        <div class="event-field-group">
                                                            <div class="event-field-form text-normal primary-text-container">
                                                                <div>{{localize "PF2ESubsystems.Infiltration.Preparations.EdgeLabel"}}</div>
                                                                <input type="text" name="{{concat "events." ../event.id ".preparations.activities." this.id ".edgeLabel"}}" value="{{this.edgeLabel}}" class="secondary-container" />
                                                            </div>
                                                        </div>
                                                        <div class="event-field-group">
                                                            <div class="event-field-form text-normal primary-text-container">
                                                                <div>{{localize "PF2ESubsystems.Infiltration.Preparations.MaxAttempts"}}</div>
                                                                <input type="text" data-dtype="Number" name="{{concat "events." ../event.id ".preparations.activities." this.id ".maxAttempts"}}" value="{{this.maxAttempts}}" class="secondary-container" />
                                                            </div>
                                                        </div>
                                                        <prose-mirror class="data-input tertiary-container" name="{{concat "events." ../event.id ".preparations.activities." this.id ".description"}}" value="{{this.description}}">
                                                            {{{this.enrichedDescription}}}
                                                        </prose-mirror>
                                                    </div>
                                                </div>
                                                <div class="event-tab tab {{../activityTabs.skillChecks.cssClass}}" data-group="{{../activityTabs.skillChecks.group}}" data-tab="{{../activityTabs.skillChecks.id}}">
                                                    <div class="event-tab-container">
                                                        {{#each this.skillChecks}}
                                                            <div class="event-field-group">
                                                                <div class="event-field-form text-normal primary-text-container">
                                                                    <div>{{localize "PF2ESubsystems.Basic.DCAdjustments"}}</div>
                                                                    <input class="infiltration-activity-dc-adjustment tertiary-container" value="{{this.dcAdjustments}}" data-event="{{../../event.id}}" data-activity="{{../id}}" data-skill-check="{{this.id}}" />
                                                                </div>
                                                            </div>
                                                            <div class="event-field-group">
                                                                <div class="event-field-form small text-normal primary-text-container">
                                                                    <div>{{localize "PF2ESubsystems.Basic.UseLeveledDC"}}</div>
                                                                    <input type="checkbox" class="infiltration-activity-leveled-DC tertiary-checkbox" data-event="{{../../event.id}}" data-activity="{{../id}}" data-skill-check="{{this.id}}" {{checked this.difficulty.leveledDC}} />
                                                                </div>
                                                                <div class="event-field-form text-normal primary-text-container">
                                                                    <div>{{localize "PF2ESubsystems.Basic.DC"}}</div>
                                                                    <input type="text" name="{{concat "events." ../../event.id ".preparations.activities." ../id ".skillChecks." this.id ".difficulty.DC"}}" value="{{this.difficulty.DC}}" class="tertiary-container" {{#if this.difficulty.leveledDC}}disabled placeholder="{{localize "PF2ESubsystems.Basic.LeveledDCIsUsed"}}"{{/if}} />
                                                                </div>
                                                            </div>
                                                            <div class="event-skill-grid activity-skill-grid secondary-container">
                                                                <div class="event-skill-grid-col">
                                                                    <div class="event-skill-grid-cell-container first event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Lore"}}</div>
                                                                    {{#each this.columns.lore}}
                                                                        <div class="event-skill-grid-cell-container first">
                                                                            <input type="checkbox" class="infiltration-activity-lore event-skill-grid-cell tertiary-checkbox" data-event="{{this.event}}" data-activity="{{this.activity}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" {{checked this.lore}} />
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                                <div class="event-skill-grid-col">
                                                                    <div class="event-skill-grid-cell-container event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Skill"}}</div>
                                                                    {{#each this.columns.skill}}
                                                                        <div class="event-skill-grid-cell-container">
                                                                            {{#if this.lore}}
                                                                                <input type="text" value="{{this.skill}}" class="infiltration-activity-skill tertiary-container primary-text-container event-skill-grid-cell" data-event="{{this.event}}" data-activity="{{this.activity}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" />
                                                                            {{else}}
                                                                                <select name="{{concat "events." this.event ".preparations.activities." this.activity ".skillChecks." this.skillCheck ".skills." this.id ".skill" }}" class="tertiary-container primary-text-container event-skill-grid-cell">
                                                                                    {{selectOptions ../../../skillOptions selected=this.skill valueAttr="value" labelAttr="name" localize=true}}
                                                                                </select>
                                                                            {{/if}}
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                                <div class="event-skill-grid-col">
                                                                    <div class="event-skill-grid-cell-container event-skill-grid-cell header tertiary-container accent">{{localize "PF2ESubsystems.Basic.Action"}}</div>
                                                                    {{#each this.columns.action}}
                                                                        <div class="event-skill-grid-cell-container">
                                                                            <select class="infiltration-preparation-action-input tertiary-container primary-text-container event-skill-grid-cell" data-event="{{this.event}}" data-activity="{{this.activity}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}">
                                                                                {{selectOptions ../../../actionOptions selected=this.action valueAttr="value" labelAttr="name" localize=true blank="" }}
                                                                            </select>
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                                <div class="event-skill-grid-col">
                                                                    <div class="event-skill-grid-cell-container event-skill-grid-cell informative header tertiary-container accent" title="{{localize "PF2ESubsystems.View.VariantExplanation"}}">{{localize "PF2ESubsystems.Basic.Variant"}}</div>
                                                                    {{#each this.columns.variant}}
                                                                        <div class="event-skill-grid-cell-container">
                                                                            <select name="{{concat "events." this.event ".preparations.activities." this.activity ".skillChecks." this.skillCheck ".skills." this.id ".variant" }}" class="tertiary-container primary-text-container event-skill-grid-cell" {{#if this.disabled}}disabled{{/if}}>
                                                                                {{selectOptions this.variantOptions selected=this.variant valueAttr="value" labelAttr="name" localize=true blank="" }}
                                                                            </select>
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                                <div class="event-skill-grid-col">
                                                                    <div class="event-skill-grid-cell-container event-skill-grid-cell informative header tertiary-container accent" title="{{localize "PF2ESubsystems.Basic.LeveledDCExplanation"}}">{{localize "PF2ESubsystems.Basic.DC"}}*</div>
                                                                    {{#each this.columns.dc}}
                                                                        <div class="event-skill-grid-cell-container">
                                                                            <input type="text" data-dtype="Number" value="{{this.dc}}" name="{{concat "events." this.event ".preparations.activities." this.activity ".skillChecks." this.skillCheck ".skills." this.id ".difficulty.DC" }}" class="tertiary-container primary-text-container event-skill-grid-cell" {{#if this.leveledDC}}disabled{{/if}} />
                                                                            <input type="checkbox" {{checked this.leveledDC}} class="infiltration-activity-leveled-dc tertiary-checkbox event-skill-grid-cell" data-event="{{this.event}}" data-activity="{{this.activity}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}" />
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                                <div class="event-skill-grid-col">
                                                                    <div class="event-skill-grid-cell-container last event-skill-grid-cell header tertiary-container accent">
                                                                        <i class="fa-solid fa-plus clickable-icon" data-action="infiltrationAddActivitySkill" data-event="{{../../event.id}}" data-activity="{{../id}}" data-skill-check="{{this.id}}"></i>
                                                                    </div>
                                                                    {{#each this.columns.action}}
                                                                        <div class="event-skill-grid-cell-container last">
                                                                            <div class="event-skill-grid-cell spaced tools-column-cell">
                                                                                <i class="fa-solid fa-tag clickable-icon label-tag {{#if this.label}}active{{/if}}" data-action="useSkillLabelMenu" data-path="{{concat "events." this.event ".preparations.activities." this.activity ".skillChecks." this.skillCheck ".skills." this.id }}" title="{{localize "PF2ESubsystems.Influence.EditInfluenceSkillLabel"}}"></i>
                                                                                <i class="fa-solid fa-trash clickable-icon" data-action="infiltrationRemoveActivitySkill" data-event="{{this.event}}" data-activity="{{this.activity}}" data-skill-check="{{this.skillCheck}}" data-skill="{{this.id}}"></i>
                                                                            </div>
                                                                        </div>
                                                                    {{/each}}
                                                                </div>
                                                            </div>
                                                        {{/each}}
                                                    </div>
                                                </div>
                                                <div class="event-tab tab {{../activityTabs.results.cssClass}}" data-group="{{../activityTabs.results.group}}" data-tab="{{../activityTabs.results.id}}">
                                                    <div class="event-tab-container">
                                                        <div class="infiltration-result-buttons">
                                                            {{#each this.results}}
                                                                <button 
                                                                    class="tertiary-container {{#if this.selected}}accent{{/if}} infiltration-result-button {{#if this.inUse}}active{{/if}}" 
                                                                    data-action="infiltrationActivityResultSelect" data-event="{{../../event.id}}" data-activity="{{../id}}" data-result="{{this.degreeOfSuccess}}"
                                                                >
                                                                    {{this.name}}
                                                                    <i class="fa-solid fa-check clickable-icon" data-action="infiltrationActivityResultToggle" data-event="{{../../event.id}}" data-activity="{{../id}}" data-result="{{this.degreeOfSuccess}}"></i>
                                                                </button>
                                                            {{/each}}
                                                        </div>
                                                        {{#if this.selectedResult}}
                                                            <div class="event-field-group">
                                                                <div class="event-field-form text-normal primary-text-container">
                                                                    <div>{{localize "PF2ESubsystems.Infiltration.Preparations.FakeDegreeOfSuccess"}}</div>
                                                                    <select name="{{concat "events." ../event.id ".preparations.activities." this.id ".results." this.selectedResult.degreeOfSuccess ".fakeDegreeOfSuccess"}}" class="tertiary-container primary-text-container">
                                                                        {{selectOptions this.selectedResult.fakeDegrees selected=this.selectedResult.fakeDegreeOfSuccess valueAttr="value" labelAttr="name" localize=true blank=""}}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <prose-mirror class="data-input tertiary-container" name="{{concat "events." ../event.id ".preparations.activities." this.id ".results." this.selectedResult.degreeOfSuccess ".description"}}" value="{{this.selectedResult.description}}" placeholder="{{localize "PF2ESubsystems.Infiltration.ComplicationResultDescription"}}">
                                                                {{{this.selectedResult.enrichedDescription}}}
                                                            </prose-mirror>
                                                        {{/if}}
                                                    </div>
                                                </div>
                                            {{else}}
                                                <div class="preparation-activity-description">{{{this.enrichedDescription}}}</div>

                                                {{#each this.skillChecks}}
                                                    <div class="infiltration-complication-skill-container">
                                                        <div class="title-small-container">{{localize "PF2ESubsystems.Basic.Overcome"}}</div>
                                                        <div class="infiltration-complication-skill-buttons">
                                                            {{#each this.dcAdjustmentValues}}
                                                                <div 
                                                                    class="infiltration-complication-skill-adjustment primary-text-container tertiary-container {{#if ../../../isGM}}clickable-icon{{/if}} {{#if (not (eq this.value ../selectedAdjustment))}}inactive{{/if}}" 
                                                                    {{#if ../../../isGM}}data-action="infiltrationActivityToggleAdjustment"{{/if}} data-event="{{../../../event.id}}" data-activity="{{../../id}}" data-skill-check="{{../id}}" data-adjustment="{{this.value}}">{{this.name}}
                                                                </div>
                                                            {{/each}}
                                                        </div>
                                                        <div class="infiltration-complication-skill-buttons">
                                                            {{#each this.skills}}
                                                                <div class="flexrow">
                                                                    {{{this.element}}}
                                                                    {{#if this.label}}<div class="text-normal italic {{#if (not ../selectedAdjustment)}}disabled{{/if}}">({{this.label}})</div>{{/if}}
                                                                </div>
                                                            {{/each}}
                                                        </div>
                                                    </div>
                                                {{/each}}
                                                <div class="infiltration-results-container">
                                                    {{#each this.results}}
                                                        {{#if this.inUse}}
                                                            <div class="preparation-activity-results-description">{{{this.enrichedDescription}}}</div>
                                                        {{/if}}
                                                    {{/each}}
                                                </div>
                                            {{/if}}
                                        </div>
                                    </div>
                                {{/if}}
                            {{/each}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>